# Устранение проблемы с Wi-Fi роутером

## Проблема: На Wi-Fi не открывается сервер, на мобильной сети работает

Если сервер доступен через мобильную сеть (4G/5G), но не через Wi-Fi, проблема в роутере или настройках Wi-Fi сети.

## Возможные причины:

1. **Роутер блокирует порт 3000**
2. **Файрвол роутера блокирует исходящие соединения**
3. **Провайдер Wi-Fi блокирует порт 3000**
4. **Настройки NAT на роутере**
5. **Родительский контроль или фильтрация контента**

## Решения:

### Решение 1: Проверка настроек роутера

1. Откройте веб-интерфейс роутера (обычно `192.168.1.1` или `192.168.0.1`)
2. Проверьте настройки файрвола:
   - Отключите файрвол временно для теста
   - Или добавьте правило для порта 3000

3. Проверьте настройки родительского контроля:
   - Отключите временно для теста
   - Или добавьте исключение для `130.61.200.70`

### Решение 2: Использовать другой порт (80 или 443)

Если роутер/провайдер блокирует порт 3000, можно изменить порт на стандартные:

#### На сервере Oracle Cloud:

```bash
# Остановите сервис
sudo systemctl stop lms-api

# Отредактируйте server.js (измените PORT на 80)
# Или установите переменную окружения
sudo nano /etc/systemd/system/lms-api.service
```

Измените:
```ini
Environment="PORT=80"
```

```bash
# Перезапустите сервис
sudo systemctl daemon-reload
sudo systemctl restart lms-api
```

#### Обновите Security List в Oracle Cloud:

1. Добавьте правило для порта 80 (если еще нет)
2. Удалите правило для порта 3000 (опционально)

#### Обновите URL в расширении:

В `js/background.js` измените:
```javascript
const defaultApiUrl = 'http://130.61.200.70:80';
```

### Решение 3: Использовать HTTPS (порт 443)

Если порт 80 тоже блокируется, можно настроить HTTPS на порту 443:

1. Установите Nginx как reverse proxy
2. Настройте SSL с Let's Encrypt
3. Используйте порт 443 (HTTPS)

### Решение 4: Проверка провайдера Wi-Fi

Некоторые провайдеры блокируют нестандартные порты. Попробуйте:

1. Позвоните в техподдержку провайдера
2. Уточните, не блокируют ли они порт 3000
3. Попросите разблокировать доступ к `130.61.200.70:3000`

### Решение 5: Использовать VPN на ПК

Если ничего не помогает, можно использовать VPN только для расширения:

1. Настройте VPN на ПК
2. Или используйте прокси для расширения Chrome

### Решение 6: Изменить порт на 8080

Порт 8080 часто не блокируется:

#### На сервере:

```bash
# Измените PORT на 8080
sudo nano /etc/systemd/system/lms-api.service
```

```ini
Environment="PORT=8080"
```

```bash
sudo systemctl daemon-reload
sudo systemctl restart lms-api
```

#### В Oracle Cloud:

1. Добавьте правило для порта 8080 в Security List (если еще нет)
2. Проверьте iptables на сервере:
```bash
sudo iptables -I INPUT 5 -p tcp --dport 8080 -j ACCEPT
sudo netfilter-persistent save
```

#### В расширении:

```javascript
const defaultApiUrl = 'http://130.61.200.70:8080';
```

## Рекомендуемое решение: Порт 80

Порт 80 (HTTP) редко блокируется роутерами и провайдерами, так как это стандартный порт для веб-трафика.

### Пошаговая инструкция:

1. **На сервере Oracle Cloud:**
   ```bash
   sudo nano /etc/systemd/system/lms-api.service
   ```
   Измените `Environment="PORT=3000"` на `Environment="PORT=80"`

2. **Перезапустите сервис:**
   ```bash
   sudo systemctl daemon-reload
   sudo systemctl restart lms-api
   ```

3. **Проверьте iptables:**
   ```bash
   sudo iptables -I INPUT 5 -p tcp --dport 80 -j ACCEPT
   sudo netfilter-persistent save
   ```

4. **В Oracle Cloud Console:**
   - Добавьте правило для порта 80 в Security List (если еще нет)

5. **Обновите расширение:**
   - Измените URL на `http://130.61.200.70` (без порта, так как 80 - стандартный)

6. **Пересоберите расширение:**
   ```bash
   npm run build:prod
   ```

## Быстрая проверка:

Попробуйте на ПК в Wi-Fi сети:

```powershell
# Проверка порта 80
Test-NetConnection -ComputerName 130.61.200.70 -Port 80

# Проверка порта 8080
Test-NetConnection -ComputerName 130.61.200.70 -Port 8080

# Проверка порта 3000
Test-NetConnection -ComputerName 130.61.200.70 -Port 3000
```

Какой порт открывается - тот и используйте!

