# Решение проблемы: сервер не доступен из интернета

## Проблема:
- ✅ `http://localhost:3000/api/health` работает
- ❌ `http://lms-solver.ddns.net:3000/api/health` не работает

## Диагностика:

### Шаг 1: Проверьте внешний IP

1. Узнайте текущий внешний IP:
   - Откройте: https://whatismyipaddress.com/
   - Запишите IPv4 адрес (например, `95.123.45.67`)

2. Проверьте IP в Dynamic DNS:
   - Зайдите в настройки Dynamic DNS
   - Проверьте, какой IP указан для `lms-solver.ddns.net`
   - **Они должны совпадать!**

3. Если IP не совпадает:
   - Обновите IP в настройках Dynamic DNS
   - Подождите 5-10 минут для распространения DNS

### Шаг 2: Проверьте проброс портов

1. Зайдите в настройки роутера
2. Найдите созданное правило проброса портов
3. Проверьте:
   - ✅ Правило включено
   - ✅ Внешний порт: 3000
   - ✅ Внутренний порт: 3000
   - ✅ В поле "Выход" выбран ваш ПК (IP: 192.168.1.63)
   - ✅ Протокол: TCP

### Шаг 3: Проверьте IP вашего ПК

1. Откройте командную строку:
   ```cmd
   ipconfig
   ```

2. Найдите "IPv4 Address" (например, `192.168.1.63`)

3. Убедитесь, что в роутере в правиле проброса портов указан именно этот IP

### Шаг 4: Проверьте брандмауэр Windows

Правило уже создано, но проверьте, что оно активно:

```powershell
Get-NetFirewallRule -DisplayName "Quiz Solver API"
```

Должно показать:
```
Enabled: True
```

### Шаг 5: Проверьте, что сервер слушает на всех интерфейсах

В `server.js` должно быть:
```javascript
app.listen(PORT, '0.0.0.0', () => {
    // '0.0.0.0' означает слушать на всех интерфейсах
});
```

Или просто:
```javascript
app.listen(PORT, () => {
    // По умолчанию слушает на всех интерфейсах
});
```

### Шаг 6: Проверьте CGNAT (провайдер блокирует порты)

Многие провайдеры используют CGNAT, который блокирует входящие соединения.

**Как проверить:**
1. Зайдите в настройки роутера
2. Найдите "WAN IP" или "Внешний IP"
3. Сравните с IP на whatismyipaddress.com

**Если IP разные** - у вас CGNAT, и проброс портов не будет работать.

**Решения:**
- Попросить у провайдера публичный IP (обычно платно)
- Использовать облачный хостинг (Railway, Render)

### Шаг 7: Проверьте через telnet

С другого компьютера (не в вашей сети):
```bash
telnet lms-solver.ddns.net 3000
```

Если подключение устанавливается - порт открыт.
Если "Connection refused" или таймаут - проблема с пробросом портов.

## Быстрая проверка:

### Тест 1: Прямой доступ по IP
Попробуйте открыть:
```
http://ваш-внешний-ip:3000/api/health
```
(Замените на ваш реальный внешний IP)

- Если работает → проблема с DNS
- Если не работает → проблема с пробросом портов

### Тест 2: Проверка порта извне
Используйте онлайн-сервис:
```
https://www.yougetsignal.com/tools/open-ports/
```

Введите:
- IP: ваш внешний IP
- Port: 3000

Если показывает "Open" - порт открыт.
Если "Closed" - проблема с пробросом портов.

## Частые проблемы:

### 1. Провайдер блокирует порты
**Решение:** Используйте облачный хостинг

### 2. Dynamic DNS не обновился
**Решение:** Обновите IP вручную, подождите 10 минут

### 3. Неправильный внутренний IP в роутере
**Решение:** Проверьте IP ПК через `ipconfig` и обновите правило

### 4. Роутер перезагрузился и правило сбросилось
**Решение:** Проверьте правило в роутере, пересоздайте если нужно

## Альтернативное решение:

Если проброс портов не работает из-за провайдера, используйте:

1. **ngrok** (для тестирования):
   ```bash
   ngrok http 3000
   ```
   Получите публичный URL типа: `https://abc123.ngrok.io`

2. **Облачный хостинг** (для продакшена):
   - Railway.app
   - Render.com
   - Fly.io

